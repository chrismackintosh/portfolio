---
import Base from "../../layouts/Base.astro";
import { withBase } from "../../utils/withBase";
import { getCollection, getEntry } from "astro:content";

// Tell Astro which /work/<slug>/ pages to build
export async function getStaticPaths() {
  const entries = await getCollection("work");
  return entries.map((e) => ({ params: { slug: e.slug } }));
}

const slug = Astro.params.slug!;
const entry = await getEntry("work", slug);
if (!entry) throw new Error(`Work entry not found: ${slug}`);

const { Content } = await entry.render();
---

<Base title={entry.data.title} description={entry.data.subtitle} ogImage={entry.data.ogImage}>
  <nav class="mb-8">
    <a
      href={withBase("/work/")}
      class="text-text-mute inline-flex items-center gap-2 text-sm hover:opacity-80"
      aria-label="Back to Work"
    >
      ‚Üê Back to Work
    </a>
  </nav>

  <article class="prose lg:prose-lg">
    <h1 class="mb-0">{entry.data.title}</h1>
    {entry.data.subtitle && <p class="text-text-mute mt-1">{entry.data.subtitle}</p>}
    <Content />
  </article>
</Base>
